<UserControl x:Class="OfflineAI.Views.UserChatView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:behavior="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:local="clr-namespace:OfflineAI.Views"
             xmlns:markdig ="clr-namespace:Markdig.Wpf;assembly=Markdig.Wpf"
             xmlns:viewmodels="clr-namespace:OfflineAI.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"
             HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
    <!--绑定数据上下文-->
    <UserControl.DataContext>
        <viewmodels:UserChatViewModel  x:Name="UserWindow"/>
    </UserControl.DataContext>
    <Grid>
        <!--命令绑定事件：窗体加载时传参数Markdown控件对象。在Grid中创建，否则会出现null异常-->
        <behavior:Interaction.Triggers>
            <behavior:EventTrigger EventName="Loaded">
                <behavior:InvokeCommandAction 
                  Command="{Binding MarkdownOBJCommand}"
                  CommandParameter="{Binding ElementName=MarkdownContent}"/>
            </behavior:EventTrigger>
        </behavior:Interaction.Triggers>
        <!--定义行-->
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="300"/>
        </Grid.RowDefinitions>
        <!--行背景色-->
        <Border Grid.Row="0" Background="#FFFFFF"/>
        <Border Grid.Row="1" Background="#5E5E5E"/>
        <Grid>
            <!--markdown 滑动条-->
            <ScrollViewer Background="#AEAEAE"
                          x:Name="MarkDownScrollViewer">
                <behavior:Interaction.Triggers>
                    <behavior:EventTrigger EventName="Loaded">
                        <behavior:InvokeCommandAction 
                         Command="{Binding ScrollLoadedCommand}"
                         PassEventArgsToCommand="True"/>
                    </behavior:EventTrigger>
                </behavior:Interaction.Triggers>
                <!--markdown-->
                <markdig:MarkdownViewer
                        Name="MarkdownContent">
                    <!--命令绑定事件：鼠标滚动显示内容-->
                    <behavior:Interaction.Triggers>
                        <!--鼠标滚动命令事件-->
                        <behavior:EventTrigger EventName="PreviewMouseWheel">
                            <behavior:InvokeCommandAction 
                             Command="{Binding MouseWheelCommand}"
                             PassEventArgsToCommand="True"/>
                        </behavior:EventTrigger>
                        <!--鼠标点击命令事件-->
                        <behavior:EventTrigger EventName="PreviewMouseDown">
                            <behavior:InvokeCommandAction 
                             Command="{Binding MouseDownCommand}"
                             PassEventArgsToCommand="True"/>
                        </behavior:EventTrigger>
                    </behavior:Interaction.Triggers>
                </markdig:MarkdownViewer>
            </ScrollViewer>
        </Grid>
        <!--第三行内容：显示回话内容-->
        <Grid Grid.Row="1"  Margin="2">
            <!--定义三行-->
            <Grid.RowDefinitions>
                <RowDefinition Height="25"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="30"/>
            </Grid.RowDefinitions>
            <!--设置Border样式-->
            <Border Grid.Row="0" Margin="150,0,150,0" Background="#5E5E5E">
                <Border.BorderThickness>2,2,2,0</Border.BorderThickness>
                <Border.BorderBrush>
                    <SolidColorBrush Color="#000000"/>
                </Border.BorderBrush>
            </Border>
            
            <Border Grid.Row="1" Margin="150,0,150,0" Background="#5E5E5E">
                <Border.BorderThickness>2,0,2,0</Border.BorderThickness>
                <Border.BorderBrush>
                    <SolidColorBrush Color="#000000"/>
                </Border.BorderBrush>
            </Border>
            
            <Border Grid.Row="2" Margin="150,0,150,0"  Background="#5E5E5E">
                <Border.BorderThickness>2,0,2,2</Border.BorderThickness>
                <Border.BorderBrush>
                    <SolidColorBrush Color="#000000"/>
                </Border.BorderBrush>
            </Border>
            <!--第2行内容区域-->
            <Grid Grid.Row="1" Margin="150,0,150,0">
                <TextBox x:Name="InputBox" Background="#5E5E5E"
                     Text="{Binding CurrentInputText , Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                     Grid.Row="1"  Margin="5" AcceptsReturn="True" 
                     VerticalScrollBarVisibility="Auto">
                    <!--回车发送-->
                    <TextBox.InputBindings>
                        <KeyBinding Command="{Binding SubmiQuestionCommand}" Key="Enter"/>
                    </TextBox.InputBindings>
                </TextBox>
            </Grid>
            <!--第3行内容区域-->
            <Grid Grid.Row="2" Margin="150,0,150,0">
                <WrapPanel HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,5,0">
                    <Button Width="50" Command="{Binding LoadFileCommand}">
                        <Image Width="24" Height="24"
                            Source="/Views/Resources/append24-black.png" 
                            HorizontalAlignment="Right" VerticalAlignment="Center"/>
                    </Button>
                    <Button Width="50" Command="{Binding SubmiQuestionCommand}" Content="{Binding SubmitButtonName}"></Button>
                </WrapPanel>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
